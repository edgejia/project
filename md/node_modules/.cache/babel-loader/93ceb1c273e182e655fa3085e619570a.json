{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\edge\\\\Desktop\\\\project-ac0cf268bcf571bf25b5db654f0165707c1e8dec\\\\md\\\\src\\\\components\\\\camera.js\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nimport { useRef, useCallback, useState, useEffect, useContext } from \"react\";\nimport Webcam from \"react-webcam\";\nimport './camera.css';\nimport Switch from '@mui/material/Switch';\nimport FormGroup from '@mui/material/FormGroup';\nimport FormControlLabel from '@mui/material/FormControlLabel';\nimport Typography from '@mui/material/Typography';\nimport { socketcontext } from \"../context/socket\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst videoConstraints = {\n  width: 720,\n  height: 600,\n  facingMode: \"user\"\n};\n\nconst Camera = () => {\n  _s();\n\n  const socket = useContext(socketcontext);\n  const webcamRef = useRef(null);\n  const [IntervalID, setIntervalID] = useState(0);\n  const [imgSrc, setImgSrc] = useState(null);\n  const [camSwitch, setCamSwitch] = useState(false);\n  const [ws, setws] = useState(null);\n\n  const connectws = () => {\n    setws(socketcontext);\n  };\n\n  useEffect(() => {\n    if (ws) {\n      console.log(ws);\n      initwebsocket();\n    } // eslint-disable-next-line\n\n  }, [ws]);\n\n  const initwebsocket = () => {\n    ws.on('connect', function () {\n      ws.emit('connect_event', 'connected to server!');\n    });\n    ws.on('server_response', function (msg) {\n      console.log(msg);\n    });\n    ws.on('connect_error', function (err) {\n      console.log(\"error code \" + err);\n    });\n    ws.on('ret_masked_img', function (pkg) {\n      setImgSrc(pkg.img);\n    });\n  };\n\n  const capture = useCallback(props => {\n    //設定捕捉鏡頭\n    if (webcamRef.current == null) {\n      clearInterval(IntervalID);\n      return;\n    }\n\n    const imageSrc = webcamRef.current.getScreenshot();\n    props.emit('mask_detect', {\n      img: imageSrc\n    });\n  }, // eslint-disable-next-line\n  [webcamRef, setImgSrc]);\n  useEffect(() => {\n    if (camSwitch) {\n      setIntervalID(setInterval(() => {\n        capture(ws);\n      }, 170));\n    } else {\n      if (ws != null) {\n        ws.emit('client_discon', 'disconnect request');\n        console.log('ws!=null');\n      }\n\n      clearInterval(IntervalID);\n      setImgSrc(null);\n    } // eslint-disable-next-line\n\n  }, [camSwitch]);\n\n  const handleswitchChange = event => {\n    if (camSwitch) {\n      setCamSwitch(false);\n    } else {\n      setCamSwitch(true);\n      connectws();\n    }\n  }; // eslint-disable-next-line\n\n\n  {\n    /*重複執行useEffect，會一直執行capture,500為延遲*/\n  }\n\n  const webcamcp = () => {\n    if (camSwitch) {\n      return /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [imgSrc &&\n        /*#__PURE__*/\n        // eslint-disable-next-line\n        _jsxDEV(\"img\", {\n          src: imgSrc,\n          className: \"webimg\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 106,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Webcam, {\n          audio: false,\n          width: 720,\n          height: 600,\n          ref: webcamRef,\n          screenshotFormat: \"image/jpeg\",\n          videoConstraints: videoConstraints,\n          mirrored: true,\n          className: \"webcam\",\n          error: \"\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true);\n    } else {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"NotShow\",\n        children: /*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"h3\",\n          color: \"white\",\n          className: \"tocenter\",\n          children: \"\\u8ACB\\u5207\\u63DB\\u4E0B\\u65B9\\u6309\\u9215\\u958B\\u555F\\u76F8\\u6A5F\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 16\n      }, this);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container\",\n    children: [webcamcp(), /*#__PURE__*/_jsxDEV(FormGroup, {\n      className: \"camSwitchpos\",\n      children: /*#__PURE__*/_jsxDEV(FormControlLabel, {\n        control: /*#__PURE__*/_jsxDEV(Switch, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 38\n        }, this),\n        label: \"Camera switch\",\n        onChange: handleswitchChange\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 130,\n    columnNumber: 12\n  }, this);\n};\n\n_s(Camera, \"0MHAY0Up+t/a3SyGJY90cuOPSfc=\");\n\n_c = Camera;\nexport default Camera;\n\nvar _c;\n\n$RefreshReg$(_c, \"Camera\");","map":{"version":3,"sources":["C:/Users/edge/Desktop/project-ac0cf268bcf571bf25b5db654f0165707c1e8dec/md/src/components/camera.js"],"names":["React","useRef","useCallback","useState","useEffect","useContext","Webcam","Switch","FormGroup","FormControlLabel","Typography","socketcontext","videoConstraints","width","height","facingMode","Camera","socket","webcamRef","IntervalID","setIntervalID","imgSrc","setImgSrc","camSwitch","setCamSwitch","ws","setws","connectws","console","log","initwebsocket","on","emit","msg","err","pkg","img","capture","props","current","clearInterval","imageSrc","getScreenshot","setInterval","handleswitchChange","event","webcamcp"],"mappings":";;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,MAAT,EAAgBC,WAAhB,EAA4BC,QAA5B,EAAqCC,SAArC,EAAgDC,UAAhD,QAAiE,OAAjE;AACA,OAAOC,MAAP,MAAmB,cAAnB;AACA,OAAO,cAAP;AACA,OAAOC,MAAP,MAAmB,sBAAnB;AACA,OAAOC,SAAP,MAAsB,yBAAtB;AACA,OAAOC,gBAAP,MAA6B,gCAA7B;AACA,OAAOC,UAAP,MAAuB,0BAAvB;AACA,SAASC,aAAT,QAA8B,mBAA9B;;;AAEA,MAAMC,gBAAgB,GAAG;AACrBC,EAAAA,KAAK,EAAE,GADc;AAErBC,EAAAA,MAAM,EAAE,GAFa;AAGrBC,EAAAA,UAAU,EAAE;AAHS,CAAzB;;AAMA,MAAMC,MAAM,GAAG,MAAK;AAAA;;AAChB,QAAMC,MAAM,GAAGZ,UAAU,CAACM,aAAD,CAAzB;AACA,QAAMO,SAAS,GAAGjB,MAAM,CAAC,IAAD,CAAxB;AACA,QAAM,CAACkB,UAAD,EAAYC,aAAZ,IAA6BjB,QAAQ,CAAC,CAAD,CAA3C;AACA,QAAM,CAACkB,MAAD,EAASC,SAAT,IAAsBnB,QAAQ,CAAC,IAAD,CAApC;AACA,QAAM,CAACoB,SAAD,EAAWC,YAAX,IAA2BrB,QAAQ,CAAC,KAAD,CAAzC;AACA,QAAM,CAACsB,EAAD,EAAIC,KAAJ,IAAavB,QAAQ,CAAC,IAAD,CAA3B;;AAIA,QAAMwB,SAAS,GAAG,MAAK;AACrBD,IAAAA,KAAK,CAACf,aAAD,CAAL;AACD,GAFD;;AAIAP,EAAAA,SAAS,CAAC,MAAI;AACZ,QAAGqB,EAAH,EAAM;AACJG,MAAAA,OAAO,CAACC,GAAR,CAAYJ,EAAZ;AACAK,MAAAA,aAAa;AACd,KAJW,CAIX;;AACF,GALQ,EAKP,CAACL,EAAD,CALO,CAAT;;AAOA,QAAMK,aAAa,GAAG,MAAK;AACzBL,IAAAA,EAAE,CAACM,EAAH,CAAM,SAAN,EAAgB,YAAU;AACxBN,MAAAA,EAAE,CAACO,IAAH,CAAQ,eAAR,EAAwB,sBAAxB;AACD,KAFD;AAGAP,IAAAA,EAAE,CAACM,EAAH,CAAM,iBAAN,EAAwB,UAASE,GAAT,EAAa;AACnCL,MAAAA,OAAO,CAACC,GAAR,CAAYI,GAAZ;AACD,KAFD;AAGAR,IAAAA,EAAE,CAACM,EAAH,CAAM,eAAN,EAAsB,UAASG,GAAT,EAAa;AACjCN,MAAAA,OAAO,CAACC,GAAR,CAAY,gBAAeK,GAA3B;AACD,KAFD;AAGAT,IAAAA,EAAE,CAACM,EAAH,CAAM,gBAAN,EAAuB,UAASI,GAAT,EAAa;AAClCb,MAAAA,SAAS,CAACa,GAAG,CAACC,GAAL,CAAT;AACD,KAFD;AAGD,GAbD;;AAkBA,QAAMC,OAAO,GAAGnC,WAAW,CAAEoC,KAAD,IAAW;AAAC;AACtC,QAAGpB,SAAS,CAACqB,OAAV,IAAmB,IAAtB,EAA2B;AACzBC,MAAAA,aAAa,CAACrB,UAAD,CAAb;AACA;AACD;;AACC,UAAMsB,QAAQ,GAAGvB,SAAS,CAACqB,OAAV,CAAkBG,aAAlB,EAAjB;AACAJ,IAAAA,KAAK,CAACN,IAAN,CAAW,aAAX,EAAyB;AAACI,MAAAA,GAAG,EAACK;AAAL,KAAzB;AAED,GARwB,EAQvB;AACF,GAACvB,SAAD,EAAYI,SAAZ,CATyB,CAA3B;AAaAlB,EAAAA,SAAS,CAAC,MAAM;AACd,QAAGmB,SAAH,EAAa;AACXH,MAAAA,aAAa,CACXuB,WAAW,CAAC,MAAM;AAClBN,QAAAA,OAAO,CAACZ,EAAD,CAAP;AACC,OAFU,EAER,GAFQ,CADA,CAAb;AAKD,KAND,MAMK;AACH,UAAGA,EAAE,IAAE,IAAP,EAAY;AACRA,QAAAA,EAAE,CAACO,IAAH,CAAQ,eAAR,EAAwB,oBAAxB;AACAJ,QAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ;AACH;;AACDW,MAAAA,aAAa,CAACrB,UAAD,CAAb;AACAG,MAAAA,SAAS,CAAC,IAAD,CAAT;AACD,KAda,CAeZ;;AACH,GAhBQ,EAgBN,CAACC,SAAD,CAhBM,CAAT;;AAkBA,QAAMqB,kBAAkB,GAAIC,KAAD,IAAU;AACnC,QAAGtB,SAAH,EAAa;AACXC,MAAAA,YAAY,CAAC,KAAD,CAAZ;AACD,KAFD,MAEK;AACHA,MAAAA,YAAY,CAAC,IAAD,CAAZ;AACAG,MAAAA,SAAS;AACV;AACF,GAPD,CAtEgB,CA8EhB;;;AACA;AAAC;AAAsC;;AAMvC,QAAMmB,QAAQ,GAAG,MAAK;AACpB,QAAGvB,SAAH,EAAa;AACX,0BAAO;AAAA,mBACNF,MAAM;AAAA;AAAK;AACR;AAAK,UAAA,GAAG,EAAEA,MAAV;AAAkB,UAAA,SAAS,EAAG;AAA9B;AAAA;AAAA;AAAA;AAAA,gBAFG,eAIL,QAAC,MAAD;AACE,UAAA,KAAK,EAAE,KADT;AAEE,UAAA,KAAK,EAAE,GAFT;AAGE,UAAA,MAAM,EAAE,GAHV;AAIE,UAAA,GAAG,EAAEH,SAJP;AAKE,UAAA,gBAAgB,EAAC,YALnB;AAME,UAAA,gBAAgB,EAAEN,gBANpB;AAOE,UAAA,QAAQ,EAAI,IAPd;AAQE,UAAA,SAAS,EAAC,QARZ;AASE,UAAA,KAAK,EAAG;AATV;AAAA;AAAA;AAAA;AAAA,gBAJK;AAAA,sBAAP;AAgBD,KAjBD,MAiBK;AACH,0BAAO;AAAK,QAAA,SAAS,EAAG,SAAjB;AAAA,+BACL,QAAC,UAAD;AACE,UAAA,OAAO,EAAC,IADV;AAEE,UAAA,KAAK,EAAG,OAFV;AAGE,UAAA,SAAS,EAAG,UAHd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADK;AAAA;AAAA;AAAA;AAAA,cAAP;AAOD;AACF,GA3BD;;AA4BA,sBAAO;AAAK,IAAA,SAAS,EAAG,WAAjB;AAAA,eACFkC,QAAQ,EADN,eAEH,QAAC,SAAD;AAAW,MAAA,SAAS,EAAG,cAAvB;AAAA,6BACE,QAAC,gBAAD;AAAkB,QAAA,OAAO,eAAE,QAAC,MAAD;AAAA;AAAA;AAAA;AAAA,gBAA3B;AAAsC,QAAA,KAAK,EAAG,eAA9C;AAA8D,QAAA,QAAQ,EAAIF;AAA1E;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,YAFG;AAAA;AAAA;AAAA;AAAA;AAAA,UAAP;AAMH,CAvHD;;GAAM5B,M;;KAAAA,M;AAwHN,eAAeA,MAAf","sourcesContent":["import React from \"react\";\nimport { useRef,useCallback,useState,useEffect, useContext} from \"react\";\nimport Webcam from \"react-webcam\";\nimport './camera.css'\nimport Switch from '@mui/material/Switch';\nimport FormGroup from '@mui/material/FormGroup';\nimport FormControlLabel from '@mui/material/FormControlLabel';\nimport Typography from '@mui/material/Typography';\nimport { socketcontext } from \"../context/socket\";\n\nconst videoConstraints = {\n    width: 720,\n    height: 600,\n    facingMode: \"user\"\n  };\n  \nconst Camera = () =>{ \n    const socket = useContext(socketcontext);\n    const webcamRef = useRef(null);\n    const [IntervalID,setIntervalID] = useState(0);\n    const [imgSrc, setImgSrc] = useState(null);\n    const [camSwitch,setCamSwitch] = useState(false);\n    const [ws,setws] = useState(null);\n\n    \n\n    const connectws = () =>{\n      setws(socketcontext)\n    }\n\n    useEffect(()=>{\n      if(ws){\n        console.log(ws);\n        initwebsocket()\n      }// eslint-disable-next-line\n    },[ws])\n\n    const initwebsocket = () =>{\n      ws.on('connect',function(){\n        ws.emit('connect_event','connected to server!');\n      });\n      ws.on('server_response',function(msg){\n        console.log(msg);\n      })\n      ws.on('connect_error',function(err){\n        console.log(\"error code \"+ err)\n      })\n      ws.on('ret_masked_img',function(pkg){\n        setImgSrc(pkg.img);\n      })\n    }\n\n    \n\n\n    const capture = useCallback((props) => {//設定捕捉鏡頭\n      if(webcamRef.current==null){\n        clearInterval(IntervalID);\n        return;\n      }\n        const imageSrc = webcamRef.current.getScreenshot();\n        props.emit('mask_detect',{img:imageSrc})\n        \n      },// eslint-disable-next-line\n      [webcamRef, setImgSrc]\n    );\n    \n\n    useEffect(() => {\n      if(camSwitch){\n        setIntervalID( \n          setInterval(() => {\n          capture(ws)   \n          }, 170)\n        );\n      }else{\n        if(ws!=null){\n            ws.emit('client_discon','disconnect request')\n            console.log('ws!=null')\n        }\n        clearInterval(IntervalID);\n        setImgSrc(null);\n      }\n        // eslint-disable-next-line\n    }, [camSwitch]);\n\n    const handleswitchChange = (event) =>{\n      if(camSwitch){\n        setCamSwitch(false);\n      }else{\n        setCamSwitch(true);\n        connectws();\n      }\n    }\n    // eslint-disable-next-line\n    {/*重複執行useEffect，會一直執行capture,500為延遲*/}\n\n    \n\n    \n\n    const webcamcp = () =>{\n      if(camSwitch){\n        return <>\n        {imgSrc && (// eslint-disable-next-line\n            <img src={imgSrc} className = \"webimg\" /> ) }\n            \n          <Webcam\n            audio={false}\n            width={720}\n            height={600}\n            ref={webcamRef}\n            screenshotFormat=\"image/jpeg\"\n            videoConstraints={videoConstraints}\n            mirrored = {true}\n            className='webcam'\n            error = \"\"\n        />\n        </>\n      }else{\n        return <div className = \"NotShow\">\n          <Typography\n            variant=\"h3\"\n            color = \"white\"\n            className = \"tocenter\"\n          >請切換下方按鈕開啟相機</Typography>\n        </div>\n      }\n    }\n    return <div className = \"container\">\n        {webcamcp()}\n        <FormGroup className = \"camSwitchpos\">\n          <FormControlLabel control={<Switch/>} label = \"Camera switch\" onChange = {handleswitchChange}/>\n        </FormGroup>\n      </div>\n}\nexport default Camera;\n"]},"metadata":{},"sourceType":"module"}